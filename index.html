<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gauntlet Arena: Full Camp & Armory</title>
    <style>
        body { background-color: #0a0a0f; color: white; margin: 0; display: flex; justify-content: center; align-items: center; height: 100vh; font-family: 'Segoe UI', Arial, sans-serif; overflow: hidden; }
        canvas { border: 4px solid #464664; background-color: #14141e; box-shadow: 0 0 50px rgba(0,0,0,1); cursor: crosshair; }
    </style>
</head>
<body>

<canvas id="gameCanvas" width="960" height="650"></canvas>

<script>
/**
 * --- GAME CONFIGURATION & ASSETS ---
 */
const canvas = document.getElementById('gameCanvas');
const ctx = canvas.getContext('2d');

const COLORS = {
    WHITE: "#FFFFFF", BLACK: "#000000", RED: "#FF4646", GREEN: "#46FF46",
    GRAY: "#646464", GOLD: "#FFD700", YELLOW: "#FFFF00", 
    DARK_BG: "#0a0a0f", CYAN: "#00FFFF", PANEL: "rgba(40, 40, 60, 0.95)", 
    ENEMY_PANEL: "rgba(60, 40, 40, 0.85)", LOG_BG: "rgba(5, 5, 10, 0.9)",
    SLOT_BG: "rgba(20, 20, 30, 0.9)", RARITY_COMMON: "#FFFFFF", RARITY_RARE: "#46A0FF", 
    RARITY_EPIC: "#A335EE", BTN_BLUE: "#005a8c"
};

const ZONE_NAMES = { "1": "Head", "2": "Chest", "3": "Stomach", "4": "Belt", "5": "Legs" };

const ENEMY_DATA = [
    ["Scavenger Scout", 60, 10, 0.05], ["Iron-Clad Guard", 160, 12, 0.02],
    ["Arcane Scribe", 100, 22, 0.10], ["Stalker Prowler", 130, 18, 0.20],
    ["Hollowed Sentinel", 250, 20, 0.05], ["Void-Caller Acolyte", 200, 30, 0.10],
    ["Blood-Oath Duelist", 220, 35, 0.15], ["Ruin-Knight Exemplar", 400, 45, 0.05],
    ["Void-General Malakor", 500, 55, 0.15], ["AETHELGARD", 1200, 85, 0.10]
];

const ALL_ITEMS = [
    {name: "Rusty Dagger", type: "weapon", STR: 2, LUCK: 1, rarity: "COMMON"},
    {name: "Soldier's Sword", type: "weapon", STR: 5, LUCK: 2, rarity: "COMMON"},
    {name: "Heavy Mace", type: "weapon", STR: 8, LUCK: 0, rarity: "COMMON"},
    {name: "Void Reaver", type: "weapon", STR: 12, LUCK: 5, rarity: "RARE"},
    {name: "Dragon Tooth", type: "weapon", STR: 15, LUCK: 3, rarity: "EPIC"},
    {name: "Leather Tunic", type: "armor", STA: 2, DEX: 1, rarity: "COMMON"},
    {name: "Reinforced Garb", type: "armor", STA: 4, DEX: 3, rarity: "COMMON"},
    {name: "Plate Mail", type: "armor", STA: 8, DEX: -2, rarity: "COMMON"},
    {name: "Ninja Suit", type: "armor", STA: 2, DEX: 10, rarity: "RARE"},
    {name: "Dragon Scale", type: "armor", STA: 12, DEX: 4, rarity: "EPIC"}
];

let state = "menu", userName = "", score = 0, currentLvl = 1;
let player = {}, enemy = {}, log = [];
let selAtk = null, selBlk = [], isProcessing = false;
let pDisplayHp = 0, eDisplayHp = 0, shake = 0, particles = [];
let highScores = JSON.parse(localStorage.getItem('gauntletScores')) || [];
let hoveredItem = null, selectedInvItem = null, tooltipPos = {x:0, y:0};

const assets = {};
function load(key, path) { const img = new Image(); img.src = path; assets[key] = img; }
load('player', 'assets/player.png');
for(let i=1; i<=10; i++) load(`enemy_${i}`, `assets/enemy_lvl_${i}.png`);
Object.keys(ZONE_NAMES).forEach(id => load(`icon_${id}`, `assets/${ZONE_NAMES[id].toLowerCase()}.png`));
ALL_ITEMS.forEach(item => load(item.name, `assets/${item.name.toLowerCase().replace(/ /g, '_')}.png`));

/**
 * --- LOGIC SYSTEMS ---
 */
function spawnText(txt, x, y, col) { particles.push({ txt, x, y, col, life: 1.0, vy: -2 }); }

function initPlayer() {
    player = { STR: 5, DEX: 5, STA: 5, LUCK: 5, hp: 0, maxHp: 0, weapon: null, armor: null, inventory: [], points: 0, bonus: {} };
    calcStats();
    player.hp = player.maxHp; pDisplayHp = player.hp;
    log = [];
    addLog("Welcome to the Gauntlet.", COLORS.GOLD);
}

function calcStats() {
    player.bonus = {STR: 0, DEX: 0, STA: 0, LUCK: 0};
    [player.weapon, player.armor].forEach(item => {
        if(item) ["STR", "DEX", "STA", "LUCK"].forEach(s => { if(item[s]) player.bonus[s] += item[s]; });
    });
    player.maxHp = 100 + ((player.STA + player.bonus.STA) * 15);
    player.dmg = 10 + ((player.STR + player.bonus.STR) * 4);
    player.dodge = Math.min(0.60, (player.DEX + player.bonus.DEX) * 0.02);
    player.crit = Math.min(0.50, (player.LUCK + player.bonus.LUCK) * 0.03);
}

function startLevel(lvl) {
    const d = ENEMY_DATA[lvl-1];
    enemy = { name: d[0], hp: d[1], maxHp: d[1], dmg: d[2], dodge: d[3] };
    eDisplayHp = enemy.hp;
    state = "combat";
    addLog(`Encountered ${enemy.name}!`, COLORS.RED);
}

function addLog(txt, col) { log.push({txt, col}); if(log.length > 50) log.shift(); }

function saveScore() {
    highScores.push({name: userName || "Hero", score: score});
    highScores.sort((a,b) => b.score - a.score);
    highScores = highScores.slice(0, 5);
    localStorage.setItem('gauntletScores', JSON.stringify(highScores));
}

/**
 * --- DRAWING HELPERS ---
 */
function drawStyledBtn(x, y, w, h, txt, baseCol) {
    ctx.fillStyle = COLORS.GOLD; ctx.fillRect(x - 2, y - 2, w + 4, h + 4);
    ctx.fillStyle = baseCol; ctx.fillRect(x, y, w, h);
    ctx.strokeStyle = COLORS.CYAN; ctx.strokeRect(x + 3, y + 3, w - 6, h - 6);
    ctx.fillStyle = COLORS.WHITE; ctx.font = "bold 16px Arial"; ctx.textAlign = "center";
    ctx.fillText(txt, x + w / 2, y + h / 2 + 6);
}

function drawProgressBar() {
    const barWidth = 700, startX = (canvas.width - barWidth) / 2, startY = 20, slotW = barWidth / 10;
    ctx.textAlign = "center"; ctx.font = "bold 10px Arial";
    for (let i = 1; i <= 10; i++) {
        const x = startX + (i - 1) * slotW, isDefeated = i < currentLvl, isCurrent = i === currentLvl;
        ctx.fillStyle = isDefeated ? COLORS.GRAY : (isCurrent ? COLORS.CYAN : "rgba(40, 40, 60, 0.6)");
        ctx.fillRect(x + 5, startY, slotW - 10, 24);
        ctx.strokeStyle = isCurrent ? COLORS.GOLD : COLORS.WHITE;
        ctx.strokeRect(x + 5, startY, slotW - 10, 24);
        ctx.fillStyle = isCurrent ? COLORS.BLACK : COLORS.WHITE;
        ctx.fillText(i, x + slotW / 2, startY + 16);
        if (isDefeated) {
            ctx.strokeStyle = COLORS.RED; ctx.lineWidth = 2; ctx.beginPath();
            ctx.moveTo(x + 8, startY + 4); ctx.lineTo(x + slotW - 12, startY + 20);
            ctx.moveTo(x + slotW - 12, startY + 4); ctx.lineTo(x + 8, startY + 20); ctx.stroke();
        }
    }
    ctx.lineWidth = 1;
}

function drawHealthBar(x, y, w, val, max, name) {
    ctx.fillStyle = "rgba(200, 50, 50, 0.3)"; ctx.fillRect(x, y, w, 20);
    ctx.fillStyle = COLORS.GREEN; ctx.fillRect(x, y, w * (Math.max(0, val)/max), 20);
    ctx.strokeStyle = "white"; ctx.strokeRect(x, y, w, 20);
    ctx.fillStyle = "white"; ctx.font = "bold 12px Arial"; ctx.textAlign = "left";
    ctx.fillText(`${name}: ${Math.floor(val)}/${max}`, x, y - 8);
}

function drawSprite(key, x, y, w, h, label, color) {
    if (assets[key] && assets[key].complete) ctx.drawImage(assets[key], x, y, w, h);
    else { ctx.fillStyle = color || "#323232"; ctx.fillRect(x, y, w, h); ctx.fillStyle = "white"; ctx.textAlign = "center"; ctx.fillText(label || key, x + w/2, y + h/2); }
}

function drawSlot(x, y, label, item) {
    ctx.fillStyle = COLORS.SLOT_BG; ctx.fillRect(x, y, 100, 100);
    ctx.strokeStyle = COLORS.GOLD; ctx.strokeRect(x, y, 100, 100);
    ctx.fillStyle = COLORS.GRAY; ctx.font = "bold 12px Arial"; ctx.textAlign = "center";
    ctx.fillText(label, x + 50, y + 20);
    if(item) drawSprite(item.name, x+15, y+25, 70, 70, item.name.substring(0,3), COLORS[`RARITY_${item.rarity}`]);
}

function drawTooltip(item, x, y) {
    ctx.fillStyle = "black"; ctx.fillRect(x+20, y+20, 200, 100);
    ctx.strokeStyle = COLORS[`RARITY_${item.rarity}`]; ctx.strokeRect(x+20, y+20, 200, 100);
    ctx.fillStyle = "white"; ctx.textAlign = "left"; ctx.font = "14px Arial"; ctx.fillText(item.name, x+30, y+45);
    const stats = item.type === "weapon" ? ["STR", "LUCK"] : ["STA", "DEX"];
    stats.forEach((s, i) => ctx.fillText(`${s}: ${item[s]}`, x+30, y+70 + i*15));
}

/**
 * --- RENDER MODES ---
 */
function drawMenu() {
    ctx.textAlign = "center"; ctx.fillStyle = COLORS.GOLD; ctx.font = "bold 50px Arial";
    ctx.fillText("GAUNTLET ARENA", 480, 250);
    ctx.fillStyle = COLORS.WHITE; ctx.font = "20px Arial"; ctx.fillText("ENTER NAME & PRESS ENTER", 480, 320);
    ctx.fillStyle = "#28283C"; ctx.fillRect(330, 340, 300, 50);
    ctx.fillStyle = COLORS.CYAN; ctx.fillText(userName + (Math.floor(Date.now()/500)%2==0?"|":""), 480, 372);
}

function drawCamp() {
    ctx.textAlign = "center"; ctx.fillStyle = COLORS.GOLD; ctx.font = "bold 40px Arial";
    ctx.fillText(`CAMP - PREPARING FOR STAGE ${currentLvl}`, 480, 100);
    ctx.fillStyle = COLORS.PANEL; ctx.fillRect(100, 150, 760, 350);
    drawSprite('player', 150, 200, 250, 250, "HERO");
    
    ctx.textAlign = "left"; ctx.font = "bold 24px Arial"; ctx.fillStyle = COLORS.CYAN;
    ctx.fillText(userName.toUpperCase(), 450, 220);
    ctx.fillStyle = COLORS.WHITE; ctx.font = "18px Arial";
    ctx.fillText(`MAX HP: ${player.maxHp}`, 450, 260);
    ctx.fillText(`ATTACK: ${player.dmg}`, 450, 290);
    ctx.fillText(`SKILL POINTS: ${player.points}`, 450, 320);

    drawStyledBtn(450, 380, 180, 50, "ARMORY (I)", COLORS.GRAY);
    drawStyledBtn(650, 380, 180, 50, "FIGHT!", COLORS.GREEN);
}

function drawCombat() {
    drawSprite('player', 20, 150, 350, 350, "HERO"); 
    drawSprite(`enemy_${currentLvl}`, 590, 150, 350, 350, enemy.name);
    drawHealthBar(40, 100, 300, pDisplayHp, player.maxHp, userName);
    drawHealthBar(620, 100, 300, eDisplayHp, enemy.maxHp, enemy.name);

    for(let i=1; i<=5; i++) {
        const id = i.toString(), y = 150 + (i-1) * 75;
        ctx.fillStyle = selBlk.includes(id) ? COLORS.CYAN : "rgba(40, 40, 60, 0.7)";
        ctx.fillRect(310, y, 70, 70); drawSprite(`icon_${id}`, 315, y+5, 60, 60, ZONE_NAMES[id]);
        ctx.fillStyle = selAtk === id ? COLORS.RED : "rgba(40, 40, 60, 0.7)";
        ctx.fillRect(580, y, 70, 70); drawSprite(`icon_${id}`, 585, y+5, 60, 60, ZONE_NAMES[id]);
    }

    if(selAtk && selBlk.length === 2 && !isProcessing) {
        drawStyledBtn(430, 495, 100, 45, "FIGHT", COLORS.GOLD);
    }

    ctx.fillStyle = COLORS.LOG_BG; ctx.fillRect(20, 545, 920, 95);
    log.slice(-5).forEach((m, i) => {
        ctx.font = "14px monospace"; ctx.fillStyle = m.col; ctx.textAlign = "left";
        ctx.fillText(`> ${m.txt}`, 40, 570 + i*14);
    });
}

function drawInventory() {
    ctx.textAlign = "center"; ctx.fillStyle = COLORS.GOLD; ctx.font = "bold 30px Arial";
    ctx.fillText("HERO'S ARMORY", 480, 80);
    ctx.fillStyle = COLORS.PANEL; ctx.fillRect(50, 110, 350, 470);
    ctx.textAlign = "left"; ctx.font = "bold 18px Arial"; ctx.fillText("STATS", 75, 145);

    ["STR", "DEX", "STA", "LUCK"].forEach((s, i) => {
        let total = player[s] + player.bonus[s];
        ctx.font = "16px Arial"; ctx.fillStyle = COLORS.WHITE;
        ctx.fillText(`${s}: ${total}`, 75, 195 + i*32);
        if(player.points > 0) {
            ctx.fillStyle = COLORS.GREEN; ctx.fillRect(340, 178 + i*32, 22, 22);
            ctx.fillStyle = COLORS.BLACK; ctx.textAlign = "center"; ctx.fillText("+", 351, 195 + i*32);
            ctx.textAlign = "left";
        }
    });

    drawSlot(75, 340, "WEAPON", player.weapon); 
    drawSlot(225, 340, "ARMOR", player.armor);
    
    ctx.fillStyle = "rgba(10, 10, 20, 0.9)"; ctx.fillRect(430, 110, 480, 400);
    player.inventory.forEach((item, i) => {
        const x = 450 + (i % 5) * 90, y = 130 + Math.floor(i / 5) * 90;
        const isEq = (player.weapon === item || player.armor === item);
        const isSel = (selectedInvItem === item);
        
        ctx.fillStyle = COLORS.SLOT_BG; ctx.fillRect(x, y, 80, 80);
        ctx.strokeStyle = isSel ? COLORS.GOLD : (isEq ? COLORS.CYAN : COLORS.GRAY);
        ctx.lineWidth = isSel || isEq ? 3 : 1;
        ctx.strokeRect(x, y, 80, 80); ctx.lineWidth = 1;

        if (isEq) {
            ctx.fillStyle = COLORS.CYAN; ctx.font = "bold 12px Arial";
            ctx.textAlign = "left"; ctx.fillText("E", x + 5, y + 15);
        }
        drawSprite(item.name, x+10, y+10, 60, 60, item.name.substring(0,2), COLORS[`RARITY_${item.rarity}`]);
    });

    if (selectedInvItem) {
        const isCurrentlyEquipped = (player.weapon === selectedInvItem || player.armor === selectedInvItem);
        drawStyledBtn(450, 450, 150, 45, "Upgrade", COLORS.BTN_BLUE); 
        drawStyledBtn(620, 450, 150, 45, isCurrentlyEquipped ? "Remove" : "Equip", COLORS.BTN_BLUE);
        ctx.fillStyle = COLORS.GOLD; ctx.textAlign = "center"; ctx.font = "bold 16px Arial";
        ctx.fillText(selectedInvItem.name.toUpperCase(), 610, 435);
    }

    if (hoveredItem) drawTooltip(hoveredItem, tooltipPos.x, tooltipPos.y);
    drawStyledBtn(430, 530, 150, 40, "BACK", COLORS.GRAY);
}

function drawEnd() {
    ctx.fillStyle = "rgba(0,0,0,0.9)"; ctx.fillRect(0,0,960,650);
    ctx.textAlign = "center"; ctx.fillStyle = state === "gameover" ? COLORS.RED : COLORS.GOLD;
    ctx.font = "bold 60px Arial"; ctx.fillText(state === "gameover" ? "DEFEATED" : "GAUNTLET CONQUERED", 480, 120);
    ctx.fillStyle = COLORS.WHITE; ctx.font = "bold 24px Arial"; ctx.fillText(`FINAL SCORE: ${score}`, 480, 180);
    ctx.fillStyle = "rgba(255, 255, 255, 0.1)"; ctx.fillRect(330, 220, 300, 220);
    ctx.fillStyle = COLORS.GOLD; ctx.font = "bold 18px Arial"; ctx.fillText("HALL OF FAME", 480, 250);
    highScores.slice(0, 5).forEach((entry, i) => {
        ctx.fillStyle = COLORS.WHITE; ctx.font = "16px monospace";
        ctx.textAlign = "left"; ctx.fillText(`${i+1}. ${entry.name}`, 350, 290 + i*25);
        ctx.textAlign = "right"; ctx.fillText(`${entry.score}`, 610, 290 + i*25);
    });
    drawStyledBtn(380, 480, 200, 60, "NEW JOURNEY", COLORS.GREEN);
}

/**
 * --- GAMEPLAY SYSTEMS ---
 */
async function resolveTurn() {
    if (isProcessing) return;
    isProcessing = true;
    let eBlkArr = ["1","2","3","4","5"].sort(()=>.5-Math.random()).slice(0,2);
    if(eBlkArr.includes(selAtk)) {
        addLog(`Enemy BLOCKED your attack!`, COLORS.YELLOW);
        spawnText("BLOCKED", 750, 300, COLORS.YELLOW);
    } else {
        let crit = Math.random() < player.crit;
        let d = Math.floor(player.dmg * (crit ? 2 : 1) * (selAtk === "1" ? 1.4 : 1));
        enemy.hp -= d; shake = crit ? 15 : 6;
        addLog(`You hit for ${d}!`, COLORS.RED);
        spawnText(d + (crit ? "!!" : ""), 750, 250, COLORS.RED);
    }
    await new Promise(r => setTimeout(r, 600));
    if(enemy.hp > 0) {
        let eAtk = Math.floor(Math.random()*5+1).toString();
        if(selBlk.includes(eAtk)) {
            addLog(`Blocked enemy ${ZONE_NAMES[eAtk]} attack!`, COLORS.CYAN);
            spawnText("BLOCK", 180, 300, COLORS.CYAN);
        } else {
            player.hp -= enemy.dmg; shake = 10;
            addLog(`Enemy hit your ${ZONE_NAMES[eAtk]}!`, COLORS.RED);
            spawnText("-" + enemy.dmg, 180, 250, COLORS.RED);
        }
    }
    selAtk = null; selBlk = []; isProcessing = false;
    checkEnd();
}

function checkEnd() {
    if(enemy.hp <= 0) {
        score += (currentLvl * 100);
        if(currentLvl === 10) { saveScore(); state = "victory"; }
        else {
            const item = ALL_ITEMS[Math.floor(Math.random()*ALL_ITEMS.length)];
            player.inventory.push(item); player.points += 2;
            player.hp = player.maxHp;
            state = "camp"; 
            addLog(`Victory! Found ${item.name}.`, COLORS.GOLD);
        }
    } else if(player.hp <= 0) { saveScore(); state = "gameover"; }
}

/**
 * --- INPUTS ---
 */
canvas.addEventListener('mousemove', e => {
    const r = canvas.getBoundingClientRect(); const mx = e.clientX - r.left, my = e.clientY - r.top;
    hoveredItem = null;
    if (state === "inventory") {
        player.inventory.forEach((item, i) => {
            const x = 450 + (i % 5) * 90, y = 130 + Math.floor(i / 5) * 90;
            if (mx > x && mx < x + 80 && my > y && my < y + 80) { hoveredItem = item; tooltipPos = {x: mx, y: my}; }
        });
    }
});

canvas.addEventListener('mousedown', e => {
    const r = canvas.getBoundingClientRect(); const mx = e.clientX - r.left, my = e.clientY - r.top;
    if (state === "menu" && userName.length > 0) { initPlayer(); startLevel(1); }
    else if (state === "camp") {
        if(mx > 450 && mx < 630 && my > 380 && my < 430) state = "inventory";
        if(mx > 650 && mx < 830 && my > 380 && my < 430) { currentLvl++; startLevel(currentLvl); }
    }
    else if (state === "inventory") {
        ["STR", "DEX", "STA", "LUCK"].forEach((s, i) => {
            if(player.points > 0 && mx > 340 && mx < 362 && my > 178 + i*32 && my < 200 + i*32) {
                player[s]++; player.points--; calcStats();
            }
        });
        if(mx > 430 && mx < 580 && my > 530 && my < 570) { state = "camp"; selectedInvItem = null; }
        player.inventory.forEach((item, i) => {
            const x = 450 + (i % 5) * 90, y = 130 + Math.floor(i / 5) * 90;
            if (mx > x && mx < x + 80 && my > y && my < y + 80) selectedInvItem = item;
        });
        if (selectedInvItem) {
            if (mx > 620 && mx < 770 && my > 450 && my < 495) {
                if (selectedInvItem.type === "weapon") player.weapon = (player.weapon === selectedInvItem) ? null : selectedInvItem;
                else player.armor = (player.armor === selectedInvItem) ? null : selectedInvItem;
                calcStats();
            }
        }
    } else if (state === "combat" && !isProcessing) {
        for(let i=1; i<=5; i++) {
            const y = 150 + (i-1) * 75;
            if(mx > 310 && mx < 380 && my > y && my < y+70) {
                if(selBlk.includes(id = i.toString())) selBlk = selBlk.filter(z => z !== id);
                else if(selBlk.length < 2) selBlk.push(id);
            }
            if(mx > 580 && mx < 650 && my > y && my < y+70) selAtk = i.toString();
        }
        if(selAtk && selBlk.length === 2 && mx > 430 && mx < 530 && my > 495 && my < 540) resolveTurn();
    } else if (state === "gameover" || state === "victory") {
        if(mx > 380 && mx < 580 && my > 480 && my < 540) { state = "menu"; userName = ""; score = 0; currentLvl = 1; }
    }
});

window.addEventListener('keydown', e => {
    if(state === "menu") {
        if(e.key === "Enter" && userName.length > 0) { initPlayer(); startLevel(1); }
        else if(e.key === "Backspace") userName = userName.slice(0, -1);
        else if(userName.length < 12 && e.key.length === 1) userName += e.key;
    }
    if(e.key.toLowerCase() === 'i' && (state === "camp" || state === "inventory")) state = (state === "inventory" ? "camp" : "inventory");
});

/**
 * --- ENGINE LOOP ---
 */
function render() {
    ctx.save();
    if (shake > 0) { ctx.translate(Math.random()*shake - shake/2, Math.random()*shake - shake/2); shake *= 0.85; }
    ctx.fillStyle = COLORS.DARK_BG; ctx.fillRect(0, 0, 960, 650);
    pDisplayHp += (player.hp - pDisplayHp) * 0.1; eDisplayHp += (enemy.hp - eDisplayHp) * 0.1;

    if (state === "menu") drawMenu();
    else if (state === "camp") drawCamp();
    else if (state === "combat") drawCombat();
    else if (state === "inventory") drawInventory();
    else if (state === "gameover" || state === "victory") drawEnd();

    if (["combat", "inventory", "camp"].includes(state)) drawProgressBar();

    particles.forEach((p, i) => {
        ctx.globalAlpha = p.life; ctx.fillStyle = p.col; ctx.font = "bold 28px Arial"; ctx.textAlign = "center";
        ctx.fillText(p.txt, p.x, p.y); p.y += p.vy; p.life -= 0.02;
        if (p.life <= 0) particles.splice(i, 1);
    });
    ctx.globalAlpha = 1.0; ctx.restore();
    requestAnimationFrame(render);
}

render();
</script>
</body>
</html>